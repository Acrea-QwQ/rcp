---
title: 'ETC5513: Collaborative and Reproducible Practices'
subtitle: "Tutorial 4"
author: "Michael Lydeamore"
date: today
format:
    unilur-html:
        output-file: index.html
        embed-resources: true
    unilur-html+solution:
        output-file: solution.html
        embed-resources: true
---


```{r, echo = FALSE, eval = file.exists("tutorial.css")}
htmltools::includeCSS("tutorial.css")
```


## `r emo::ji("target")` Objectives

* Create repositories and syncrhonize them between your local and remote repos
* Create a Quarto report with a tabell, figures and sections that are labelled and referenced
* Create branches in local and remote repositories
* Deal with merge conflicts

## Merging branches

Continuing on from the workshop, we will now learn how to merge two branches together.

We currently have two branches: `main` and `globaloptions`.

1. Using the command line, merge `globaloptions` into `main`, and push this change onto the remote repo.

::: {.callout-tip}
You always want to be on the branch you are making changes to, which is `main` in this case.
:::

::: {.unilur-solution}
```
git branch
git checkout main
git merge globaloptions -m "Merging branches"
git push
```
:::

2. Inspect the diff window in Rtudio. Now both branches should be merged.

## Merge conflicts

Your GitHub repository should contain the files `README.md` and `week4.qmd`.

::: {.callout-caution}
Check the history of your commits  and check that your branch is merged to main branch.
:::

1. Update your `README.md`  on GitHub directly. At the same location in the `README.md`  where you wrote the sentence "I am creating a conflict part 2" in your local repo, now add the following sentence "I have two conflicting versions". 

![](../images/editinggithub.png){fig-align="center"}

![](../images/Commit_github.png){fig-align="center"}

2. Create a conflict: Inside Rstudio open the `README.md` file and change the first heading "This is tutorial 4" to  "I am creating a conflict" 
3. Create a commit for this change with message "Conflict1".
4. Select the changes you want to commit and click stage selection. Add a commit message and click Commit.
5. Now go to Rstudio  and push your commit (you can simple click on Push on the top left pane - **You don't need to click to commit cause you have already done it before**.
6. You will get an error message as follows.

![](../images/error.png){fig-align="center"}

![](../images/Commit_github.png){fig-align="center"}

7. Open README.md in RStudio and fix the conflicts: Remove both sentences and add a new one instead that says "I have learned to create and fix a conflict!".

::: {.unilur-solution}
To resolve the conflict, remove all the conflict markers and save the file:

```
 /* code unaffected by conflict */
<<<<<<< HEAD
/* code from master that caused conflict */
=======
/* code from feature that caused conflict */
```
:::


13. Commit the changes.

::: {.unilur-solution}
```
git add README.md
git commit -m "Resolving merge conflict"
```
:::


14. Push the repo to GitHub.

::: {.unilur-solution}
`git push origin main`
:::

## Cross-referencing and academic referencing

In this exercise you will learn how to reference figures, tables and sections in your report. We will also learn how to cite external sources.

1. Open the file `week4.qmd` and add the following to the end of the document:

```{{r}}
#| label: fig-penguins
#| fig-cap: "Bill length vs bill depth of three species of penguins from the Palmer Station, Antarctica"

library(palmerpenguins)

ggplot(penguins, aes(x=bill_length_mm, y=bill_depth_mm, colour=species)) +
  geom_point()
```

```{r}
#| echo: false
#| eval: false

library(tidyverse)
library(palmerpenguins)

ggplot(penguins, aes(x=bill_length_mm, y=bill_depth_mm, colour=species)) +
  geom_point()
```

2. Add a sentence below this chunk that says: `@fig-penguins shows that the three species of penguins have clusters of bill depths and bill lengths that largely do not overlap`

3. Render the document. You should see a hyperlink to Figure 1, that links back to your original figure.

### Home extension: Academic referencing

With Quarto, we no longer need to type out references manually. With the help of some external software, our external references can be automatically generated.

::: {.callout-tip}
If you get stuck on this section, check out the video on Moodle.
:::


1. Download Zotero: <https://www.zotero.org/> and register for a free account.
2. Install the Better BibTeX for Zotero extension: <https://retorque.re/zotero-better-bibtex/installation/>
3. Install the relevant Connector for your web browser: <https://www.zotero.org/download/connectors>
4. We will add the reference by it's _Digial Object Identifier_ or DOI. The DOI for `palmerpenguins` is 10.5281/zenodo.3960218. Press the small "Add item by identifier" button in Zotero, and paste in the DOI:

![](../images/add_object.png){fig-align="center"}

5. In Zotero, right click the newly added item, go to "Better BibTex" -> "copy BibTeX to clipboard"

![](../images/copy-bibtex.png){fig-align="center"}


6. Inside your project, create a new file called `references.bib`. Paste the BibTeX you just copied in there. It should look something like this:

```
@misc{horstAllisonhorstPalmerpenguinsV0102020,
  title = {Allisonhorst/Palmerpenguins: V0.1.0},
  shorttitle = {Allisonhorst/Palmerpenguins},
  author = {Horst, Allison M and Hill, Alison Presmanes and Gorman, Kristen B},
  year = {2020},
  month = jul,
  doi = {10.5281/ZENODO.3960218},
  urldate = {2025-03-24},
  abstract = {CRAN release of palmerpenguins v0.1.0 R package by Horst, Hill and Gorman (July 2020).},
  copyright = {Open Access},
  howpublished = {Zenodo}
}
```

7. In `week4.qmd`, add the following to the YAML:

```
bibliography: references.bib
```

8. In the sentence we wrote describing Figure 1, add the following to the end of the sentence: `@horstAllisonhorstPalmerpenguinsV0102020`.

9. Re-render the document. You should have a reference to the package where you typed `@horstAllisonhorstPalmerpenguinsV0102020`, and you should see a references section at the end of the document.